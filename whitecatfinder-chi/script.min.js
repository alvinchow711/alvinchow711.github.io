(function(o){var h="sync/data.xml";var q="sync/stage.txt";var j=$("#wc-stageselected .text");var e=$("#wc-stagelist");var i=$("#wc-searchBtn");var t=$("#wc-searchresult");var l=$("#wc-searchloading");var r=$("#wc-requestInput");var s=$("#wc-requestBtn");var n=$("#wc-loading");var g=$("#wc-retry");var f=$("#wc-content");var d=null;var m=null;var b=null;var u=null;function p(){g.addClass("hide");n.removeClass("hide");d=null;m=null;$.ajax({url:h,cache:false,dataType:"text",success:function(v){d=$(v);c()},fail:function(v){g.removeClass("hide")}});$.ajax({url:q,cache:false,dataType:"text",success:function(z){var w=z.split(/[\r\n]+/);var A=true;var y=null;m=[];for(var x=0;x<w.length;x++){var v=w[x].trim();if(v==""){continue}if(v.indexOf("---")>=0){m.push([v.replace(/^---|---$/g,""),false]);continue}if(A){y=v}else{m.push([y,true])}A=!A}c()},fail:function(v){g.removeClass("hide")}})}function c(){if(d==null||m==null){return}n.addClass("hide");f.removeClass("hide");e.empty();var v=true;$.each(m,function(z,y){var w=!y[1];var B=y[0];var x;if(w){x=$("<li>").addClass("dropdown-header").attr("role","presentation").text(B).click(function(){return false})}else{if(v){v=false;j.text(B)}var A=$('<a href="#">').text(B).click(function(){j.text($(this).text());r.val("");b=null});x=$("<li>").append(A)}x.appendTo(e)})}function k(v){return btoa(unescape(encodeURIComponent(v))).replace(/=+$/,"")}o.searchTeam=function(){var x=j.text();var v=k(x);var y=d.find("api").text()+"/v2/team/"+v;l.removeClass("hide");t.addClass("hide");i.addClass("disabled");_gaq.push(["_trackEvent","web","search",x]);var w=b;setTimeout(w===null?function(){$.post(y,function(z){a(x,z)})}:function(){console.log("using cache");a(w.stage,w.codeBase64)},300)};function a(w,C){t.empty();var z=atob(C);for(var x=0;x<z.length;x+=3){var B=z.charCodeAt(x);var A=z.charCodeAt(x+1);var y=z.charCodeAt(x+2);var v="0000"+(B*65536+A*256+y);$('<li class="list-group-item">').text(v.substring(v.length-5)).appendTo(t)}l.addClass("hide");t.removeClass("hide");i.removeClass("disabled");b={stage:w,codeBase64:C};if(u!=null){clearTimeout(u)}u=setTimeout(function(){b=null},2000)}o.requestTeam=function(){var A=r.val();if(!/^\d{5}$/.test(A)){alert("請輸入５位數字的房間號碼。");return}s.addClass("disabled").text("發送中...");var z=10;var v=function(){if(z==0){s.removeClass("disabled").text("募集")}else{s.text("發送完成 ("+z+")");z--;setTimeout(v,1000)}};var x=j.text();var w=k(x);_gaq.push(["_trackEvent","web","request",x]);var y=d.find("api").text()+"/v2/team/"+w+"/"+A;$.post(y,function(B){v()})};$(p)})(this);var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-54054345-3"]);_gaq.push(["_trackPageview"]);_gaq.push(["_trackEvent","web","startService"]);(function(){var b=document.createElement("script");b.type="text/javascript";b.async=true;b.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(b,a)})();